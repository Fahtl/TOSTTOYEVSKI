<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
// Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø­ØªÙ‰ Ù„Ùˆ Supabase Ù…Ø§ Ø§Ø´ØªØºÙ„
let supabase = null;

try{
const supabaseUrl = "https://cufbyiefzbgygtyibupl.supabase.co";
const supabaseKey = "sb_publishable_mTI9Fl-eMcN3TbLqyQAGNw_fzQF7ssr";

if(window.supabase){
supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
}
}catch(e){
console.log("Supabase not loaded - developer panel still works");
}

let isDeveloper=false;
let deleteMode=false;
let priceEditMode=false;

const SECRET_PASSWORD="momotunc0702";

/* Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø± */
async function getPrice(){
if(!supabase){
document.getElementById("price").innerText="60";
return;
}

try{
const { data, error } = await supabase
.from("settings")
.select("price")
.eq("id",1)
.single();

if(data){
document.getElementById("price").innerText=data.price;
}
}catch(e){
document.getElementById("price").innerText="60";
}
}

/* ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± */
async function updatePrice(newPrice){
if(!supabase){
alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¹Ø± Ù…Ø­Ù„ÙŠØ§Ù‹");
return;
}

try{
await supabase
.from("settings")
.update({price:newPrice})
.eq("id",1);

alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± ðŸ”¥");
}catch(e){
alert("Ø®Ø·Ø£ ØªØ­Ø¯ÙŠØ«");
}
}

/* ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø·ÙˆØ± */
function openDev(){
document.getElementById("devPanel").style.display="block";
document.getElementById("overlay").style.display="block";
isDeveloper=true;
updateCategorySelect();
}

/* Ø§ØºÙ„Ø§Ù‚ */
function closeDev(){
isDeveloper=false;
deleteMode=false;
priceEditMode=false;
document.getElementById("devPanel").style.display="none";
document.getElementById("overlay").style.display="none";
}

/* Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠ */
let clickCount=0;
let timer=null;

document.getElementById("secretTrigger").onclick=function(){
clickCount++;

if(timer) clearTimeout(timer);
timer=setTimeout(()=>{clickCount=0},3000);

if(clickCount===5){
clickCount=0;
let pass=prompt("ðŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±");
if(pass===SECRET_PASSWORD){
openDev();
}else{
alert("Ø®Ø·Ø£");
}
}
};

/* Ø¶ØºØ· Ø§Ù„Ø³Ø¹Ø± */
let priceClicks=0;
document.getElementById("price").onclick=function(){
if(isDeveloper) return;

priceClicks++;
setTimeout(()=>{priceClicks=0},2000);

if(priceClicks>=3){
priceClicks=0;
let pass=prompt("ðŸ” ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±");
if(pass===SECRET_PASSWORD){
openDev();
}
}
};

/* Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ */
function scrollToMenu(){
document.getElementById("menu").scrollIntoView({behavior:"smooth"});
}

function updateCategorySelect(){
let select=document.getElementById("categorySelect");
if(!select) return;
select.innerHTML="";
document.querySelectorAll(".card h3").forEach(h=>{
let o=document.createElement("option");
o.textContent=h.innerText;
select.appendChild(o);
});
}

/* ØªØ´ØºÙŠÙ„ */
window.onload=function(){
getPrice();
updateCategorySelect();
};
</script>
